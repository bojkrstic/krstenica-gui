{{ define "svestenici/picker-table.html" }}
{{ $data := .Data }}
{{ $query := "" }}
{{ if $data }}{{ $query = $data.Pagination.Query }}{{ end }}
<div id="svestenici-picker-table"
     data-field="{{ .Field }}"
     hx-get="/ui/svestenici/picker/table?field={{ .Field }}{{ if $query }}&{{ $query }}{{ end }}"
     hx-trigger="refresh-svestenici-picker-table from:body"
     hx-target="this"
     hx-swap="outerHTML">
    {{ if and $data $data.Items }}
    {{ $field := .Field }}
    <table role="grid">
        <thead>
            <tr>
                <th>Ime</th>
                <th>Prezime</th>
                <th>Grad</th>
                <th>Titula</th>
                <th>Akcija</th>
            </tr>
        </thead>
        <tbody>
            {{ range .Data.Items }}
            <tr>
                <td>{{ .FirstName }}</td>
                <td>{{ .LastName }}</td>
                <td>{{ if .City }}{{ .City }}{{ else }}-{{ end }}</td>
                <td>{{ if .Title }}{{ .Title }}{{ else }}-{{ end }}</td>
                <td>
                    <button class="secondary"
                            type="button"
                            hx-get="/ui/svestenici/picker/select/{{ .ID }}?field={{ $field }}"
                            hx-target="body"
                            hx-swap="none"
                            data-close-dialog>
                        Izaberi
                    </button>
                </td>
                <script>
                    document.body.addEventListener("htmx:beforeRequest", function(evt) {
                        const btn = evt.detail.elt;
                        if (!btn || !btn.matches("button[hx-get*='/ui/svestenici/picker/select/']")) {
                            return;
                        }

                        const row = btn.closest("tr");
                        if (!row) {
                            return;
                        }

                        const ime = row.children[0].innerText.trim();
                        const prezime = row.children[1].innerText.trim();
                        console.log("âœ… Odabran svestenik:", ime, prezime);
                    });
                </script>
            </tr>
            {{ end }}
        </tbody>
    </table>
    {{ else }}
    <p>Nema rezultata.</p>
    {{ end }}
</div>
{{ end }}
