{{ define "osobe/picker-table.html" }}
{{ $data := .Data }}
{{ $query := "" }}
{{ if $data }}{{ $query = $data.Pagination.Query }}{{ end }}
<div id="osobe-picker-table"
     data-field="{{ .Field }}"
     hx-get="/ui/osobe/picker/table?field={{ .Field }}{{ if $query }}&{{ $query }}{{ end }}"
     hx-trigger="refresh-osobe-picker-table from:body"
     hx-target="this"
     hx-swap="outerHTML">
    {{ if and $data $data.Items }}
    {{ $field := .Field }}
    <table role="grid">
        <thead>
            <tr>
                <th>Име</th>
                <th>Презиме</th>
                <th>Улога</th>
                <th>Град</th>
                <th>Акција</th>
            </tr>
        </thead>
        <tbody>
            {{ range .Data.Items }}
            <tr>
                <td>{{ .FirstName }}</td>
                <td>{{ .LastName }}</td>
                <td>{{- if eq .Role "mother" -}}Мајка{{- else if eq .Role "father" -}}Отац{{- else if eq .Role "godfather" -}}Кум{{- else if eq .Role "paroh" -}}Парох{{- else -}}-{{- end -}}</td>
                <td>{{ if .City }}{{ .City }}{{ else }}-{{ end }}</td>
                <td>
                    <button class="secondary"
                            type="button"
                            hx-get="/ui/osobe/picker/select/{{ .ID }}?field={{ $field }}"
                            hx-target="body"
                            hx-swap="none" data-close-dialog>
                        Изабери
                    </button>
                </td>
                <script>
                    document.body.addEventListener("htmx:beforeRequest", function(evt) {
                    const btn = evt.detail.elt;

                    // proveri da li je kliknuto baš na "Izaberi" dugme iz pickera
                    if (btn.matches("button[hx-get*='/ui/osobe/picker/select/']")) {

                        // nađi red (tr) u kome se nalazi dugme
                        const row = btn.closest("tr");

                        // iz ćelija (td) reda čitamo ime i prezime
                        const ime = row.children[0].innerText.trim();
                        const prezime = row.children[1].innerText.trim();

                        console.log("✅ Одабрано:", ime, prezime);
                    }
                    });
                </script>
            </tr>
            {{ end }}
        </tbody>
    </table>
    {{ else }}
    <p>Нема резултата.</p>
    {{ end }}
</div>
{{ end }}
