{{ define "osobe/picker-table.html" }}
<div id="osobe-picker-table">
    {{ if .Data.Items }}
    {{ $field := .Field }}
    <table role="grid">
        <thead>
            <tr>
                <th>Ime</th>
                <th>Prezime</th>
                <th>Uloga</th>
                <th>Grad</th>
                <th>Akcija</th>
            </tr>
        </thead>
        <tbody>
            {{ range .Data.Items }}
            <tr>
                <td>{{ .FirstName }}</td>
                <td>{{ .LastName }}</td>
                <td>{{ .Role }}</td>
                <td>{{ if .City }}{{ .City }}{{ else }}-{{ end }}</td>
                <td>
                    <button class="secondary"
                            type="button"
                            hx-get="/ui/osobe/picker/select/{{ .ID }}?field={{ $field }}"
                            hx-target="body"
                            hx-swap="none" data-close-dialog>
                        Izaberi
                    </button>
                </td>
                <script>
                    document.body.addEventListener("htmx:beforeRequest", function(evt) {
                    const btn = evt.detail.elt;

                    // proveri da li je kliknuto baš na "Izaberi" dugme iz pickera
                    if (btn.matches("button[hx-get*='/ui/osobe/picker/select/']")) {

                        // nađi red (tr) u kome se nalazi dugme
                        const row = btn.closest("tr");

                        // iz ćelija (td) reda čitamo ime i prezime
                        const ime = row.children[0].innerText.trim();
                        const prezime = row.children[1].innerText.trim();

                        console.log("✅ Odabrano:", ime, prezime);
                    }
                    });
                </script>
            </tr>
            {{ end }}
        </tbody>
    </table>
    {{ else }}
    <p>Nema rezultata.</p>
    {{ end }}
</div>
{{ end }}
